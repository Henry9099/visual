<!DOCTYPE html>
<html>
<head>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<style>
		text {
			font-family: 'Arial'
		}
		div.hand_buttons{
			position: fixed;
			top: 75px;
			left: 100px;
		}
		div.hand_buttons div {
			background-color: rgb(251, 201, 127);
        		padding: 20px;
        		margin: 20px;
        		font-family: 'Arial';	
		}
	</style>
	<script type="text/javascript">
		function draw(data) {
			'use strict';
			var margin = 75,
				width = 1400 - margin,
				height = 600 - margin;

			var svg = d3.select('body')
				.append('svg')
				.attr('width', width + margin)
				.attr('height', height + margin)
				.append('g')
				.attr('class', 'graph');

			svg.append('g')
				.attr('class', 'bubble')
				.selectAll('circle')
				.data(data, function(d) {
					return d['name']
				})
				.enter()
				.append('circle')

			var avg_extent = d3.extent(data, function(d) {
				return d['avg'];
			});

			var HR_extent = d3.extent(data, function(d) {
				return d['HR'];
			});

			var avg_scale = d3.scale.linear()
				.range([margin, width])
				.domain(avg_extent)

			var HR_scale = d3.scale.linear()
				.range([height, margin])
				.domain(HR_extent);

			var avg_axis = d3.svg.axis()
				.scale(avg_scale);

			var HR_axis = d3.svg.axis()
				.scale(HR_scale)
				.orient('left');

				svg.append('g')
				.attr('class', 'x axis')
				.attr('transform', 'translate(0,' + height + ')')
				.call(avg_axis)

				svg.append('g')
				.attr('class', 'y axis')
				.attr('transform', 'translate(' + margin + ',0)')
				.call(HR_axis)


			d3.selectAll('circle')
				.attr('cx', function(d) {
					return avg_scale(d['avg']);
				})
				.attr('cy', function(d) {
					return HR_scale(d['HR']);
				})
				.attr('r', 5)
		            .attr('fill', function(d) {
		            	if (d['handedness'] == 'R') {
		            		return 'blue'
		            	} else if (d['handedness'] == 'L') {
		            		return 'green'
		            	} else {
		            		return 'red';
		            	}
	            	});


	            svg.append('text')
	            	.attr('class', 'y axis label')
	            	.attr('text-anchor', 'middle')
	            	.attr('transform', 'translate(' + (margin / 2 - 5) +',' + (height / 2) + ')rotate(-90)')
	            	.text('Home Runs in Career');

	            svg.append('text')
	            	.attr('class', 'x axis label')
	            	.attr('text-anchor', 'middle')
	            	.attr('transform', 'translate(' + (width / 2) +',' + (height + margin - 30) + ')rotate(0)')
	            	.text('Average Runs per Game');

	            var hands = ['L','R', 'B']

	            var buttons = d3.select('body')
	            			.append('div')
	            			.attr('class', 'hand_buttons')
	            			.selectAll('div')
	            			.data(hands)
	            			.enter()
	            			.append('div')
	            			.text(function(d) {
	            				return d;
	            			});
	            function agg_hand(leaves) {
	            	var people = d3.set()

	            	leaves.forEach(function(d) {
	            		people.add(d['name']);
	            	});

	            	return {
	            		'people': people.values()
	            	}
	            }

	            var nested = d3.nest()
	            			.key(function(d) {
	            				return d['handedness'];
	            			})
	            			.rollup(agg_hand)
	            			.entries(data);
	            
	            function update(hand,data) {
            		var filtered = data.filter(function(d) {
            			return d['handedness'] === hand;
            		});
            		debugger;

	            	var circles = svg.selectAll('circle')
	            				.data(filtered);
	            				

	            	circles.exit().remove();

	            	circles.enter()
	            		.append('circle')
	            		.style('fill', 'red');

	            }

	            buttons.on('click', function(d) {
	            	update(d, data);
	            })



		}




	</script>

</head>
<body>

<script type="text/javascript">
	d3.csv("baseball_data.csv", function(d) {
		d['height'] = +d['height'];
		d['weight'] = +d['weight'];
		d['avg'] = +d['avg'];
		d['HR'] = +d['HR'];
		return d;
	}, draw);
</script>

</body>
</html>












